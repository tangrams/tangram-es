branches:
    only:
        - master

matrix:
    include:
        # - os: osx
        #   osx_image: xcode7.3
        #   language: cpp
        #   env: PLATFORM=osx
        #   compiler: clang
        - os: linux
          dist: trusty
          sudo: false
          language: cpp
          env: PLATFORM=linux
          addons:
            apt:
              packages: [ 'xorg-dev', 'libglu1-mesa-dev' ]
        # - os: osx
        #   osx_image: xcode7.3
        #   language: cpp
        #   env: PLATFORM=ios
        #   compiler: clang
        - os: linux
          dist: trusty
          sudo: false
          language: android
          env: PLATFORM=android
          addons:
            apt:
              packages: [ 'cmake', 'lib32z1-dev', 'lib32stdc++6', 's3cmd' ]
          android:
            components: [ 'tools', 'build-tools-24.0.2', 'extra-android-m2repository', 'android-24' ]
          jdk: oraclejdk8

before_install:
    - git submodule update --init --recursive
    - source ./scripts/travis/before_install.sh

install: ulimit -c

before_script:
    # Set the core file limit to unlimited so a core file is generated upon crash
    - ulimit -c unlimited -S

# build test project
script:
    - source ./scripts/travis/script_build.sh
    - source ./scripts/travis/script_run_tests.sh
    - source ./scripts/travis/script_run_bench.sh

after_success:
    - source ./scripts/travis/script_deploy_android_snapshot.sh
    - source ./scripts/travis/script_deploy_android_demo.sh
